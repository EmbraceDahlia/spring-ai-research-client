<div
  class="modal-overlay"
  *ngIf="imagePreviewUrl"
  (click)="closeImagePreview()"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    
    <!-- ❌ Cancel button in top-right -->
    <button class="close-button" (click)="closeImagePreview()" title="Cancel">
      &times;
    </button>

    <!-- Image Preview -->
    <img [src]="imagePreviewUrl" alt="Image Preview" />

    <!-- Question textarea + send -->
    <div class="textarea-wrapper">
      <textarea
        [(ngModel)]="imageQuestion"
        rows="2"
        placeholder="Type your question..."
      ></textarea>
      <button class="send-button" (click)="uploadImageWithQuestion()" title="Send">
        <i class="bi bi-send"></i>
      </button>
    </div>
  </div>
</div>


<!-- Chat Container -->
<div class="chat-container">
  <h2>Personal Assistant</h2>

  <!-- Chat Message Area -->
  <div class="chat-window" #chatWindow>
    <div *ngFor="let message of chatHistory" class="chat-message" [ngClass]="message.role">
      <div class="bubble">
        <ng-container *ngIf="message.image">
          <img [src]="message.image" class="chat-image" />
        </ng-container>
        <div *ngIf="message.text">{{ message.text }}</div>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="input-area">
  <textarea
    [(ngModel)]="userInput"
    rows="2"
    placeholder="Type your question..."
  ></textarea>

  <!-- Icons inside the input area -->
  <div class="input-icons-inside">
    <input
      type="file"
      #imageInput
      accept="image/*"
      style="display: none"
      (change)="onImageSelected($event)"
    />
    <button type="button" (click)="imageInput.click()" title="Attach Image">
      <i class="bi bi-image"></i>
    </button>

    <input
      type="file"
      #fileInput
      style="display: none"
      (change)="onFileSelected($event)"
    />
    <button type="button" (click)="fileInput.click()" title="Attach File">
      <i class="bi bi-paperclip"></i>
    </button>

    <!-- Send Button -->
    <button
      type="button"
      (click)="sendMessage()"
      [disabled]="!userInput.trim()"
      title="Send"
    >
      <i class="bi bi-send"></i>
    </button>
  </div>
</div>

</div>



